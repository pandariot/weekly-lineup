import React, { useState, useRef, useEffect } from 'react';

// â”€â”€â”€ SAMPLE DATA (replaced by admin panel in production) â”€â”€â”€
const SAMPLE_PUZZLES = [
  {
    id: 'spotify', category: 'SPOTIFY', icon: 'ğŸ¤', color: '#1DB954',
    prompt: 'Most monthly listeners on Spotify right now', direction: 'most to fewest monthly listeners',
    items: [
      { name: 'The Weeknd', value: '115.2M listeners', sortValue: 1152 },
      { name: 'Taylor Swift', value: '97.8M listeners', sortValue: 978 },
      { name: 'Billie Eilish', value: '82.4M listeners', sortValue: 824 },
      { name: 'Bad Bunny', value: '71.6M listeners', sortValue: 716 },
      { name: 'Sabrina Carpenter', value: '64.3M listeners', sortValue: 643 },
    ],
  },
  {
    id: 'box_office', category: 'BOX OFFICE', icon: 'ğŸ¬', color: '#E50914',
    prompt: 'Highest grossing at the box office this weekend', direction: 'highest to lowest gross',
    items: [
      { name: 'Dune: Part Three', value: '$82.4M', sortValue: 824 },
      { name: 'Captain America: Brave New World', value: '$45.1M', sortValue: 451 },
      { name: 'Bridget Jones: Mad About the Boy', value: '$22.3M', sortValue: 223 },
      { name: 'The Monkey', value: '$14.7M', sortValue: 147 },
      { name: 'Paddington in Peru', value: '$8.9M', sortValue: 89 },
    ],
  },
  {
    id: 'google', category: 'MOST GOOGLED', icon: 'ğŸ”', color: '#4285F4',
    prompt: 'Most Googled people this week', direction: 'most to fewest searches',
    items: [
      { name: 'Taylor Swift', value: '12.4M searches', sortValue: 124 },
      { name: 'Travis Kelce', value: '9.8M searches', sortValue: 98 },
      { name: 'Zendaya', value: '7.2M searches', sortValue: 72 },
      { name: 'Pete Davidson', value: '5.6M searches', sortValue: 56 },
      { name: 'Ice Spice', value: '3.1M searches', sortValue: 31 },
    ],
  },
  {
    id: 'billboard', category: 'BILLBOARD', icon: 'ğŸµ', color: '#FF6B35',
    prompt: 'Highest on the Hot 100 this week', direction: 'highest to lowest chart position',
    items: [
      { name: 'Die With A Smile â€“ Lady Gaga & Bruno Mars', value: '#1', sortValue: 100 },
      { name: 'APT. â€“ ROSÃ‰ & Bruno Mars', value: '#3', sortValue: 98 },
      { name: 'Lovers & Friends â€“ Usher', value: '#5', sortValue: 96 },
      { name: 'Luther â€“ Kendrick Lamar & SZA', value: '#7', sortValue: 94 },
      { name: 'Timeless â€“ The Weeknd & Playboi Carti', value: '#9', sortValue: 92 },
    ],
  },
  {
    id: 'wikipedia', category: 'WIKIPEDIA', icon: 'ğŸŒ', color: '#636466',
    prompt: 'Most viewed on Wikipedia this week', direction: 'most to fewest pageviews',
    items: [
      { name: 'Conan O\'Brien', value: '4.8M views', sortValue: 48 },
      { name: 'Severance (TV series)', value: '3.2M views', sortValue: 32 },
      { name: 'Super Bowl LX', value: '2.9M views', sortValue: 29 },
      { name: 'TimothÃ©e Chalamet', value: '2.1M views', sortValue: 21 },
      { name: 'Bird flu', value: '1.7M views', sortValue: 17 },
    ],
  },
];

const shuffleArray = (arr) => {
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
};

const getScoreEmoji = (diff) => diff === 0 ? 'ğŸŸ©' : 'ğŸŸ¥';

export default function TheLineup() {
  const [screen, setScreen] = useState('menu');
  const [puzzle, setPuzzle] = useState(null);
  const [items, setItems] = useState([]);
  const [attempt, setAttempt] = useState(1);
  const maxAttempts = 3;
  const [feedback, setFeedback] = useState(null);
  const [history, setHistory] = useState([]);
  const [solved, setSolved] = useState(false);
  const [copied, setCopied] = useState(false);
  const [completedRounds, setCompletedRounds] = useState([]);
  const [allResults, setAllResults] = useState({});

  // Drag state
  const [activeItem, setActiveItem] = useState(null);
  const [dragY, setDragY] = useState(0);
  const dragStartY = useRef(0);
  const dragItemHeight = useRef(72);
  const itemsRef = useRef([]);
  const itemsCopy = useRef([]);

  const currentUnlocked = completedRounds.length;

  const startGame = (p) => {
    setPuzzle(p);
    setItems(shuffleArray(p.items.map((item, i) => ({ ...item, correctIndex: i, id: `item-${i}` }))));
    setAttempt(1);
    setFeedback(null);
    setHistory([]);
    setSolved(false);
    setCopied(false);
    setActiveItem(null);
    setScreen('play');
  };

  const moveItem = (fromIndex, toIndex) => {
    if (toIndex < 0 || toIndex >= items.length || feedback) return;
    setItems(prev => {
      const next = [...prev];
      const [moved] = next.splice(fromIndex, 1);
      next.splice(toIndex, 0, moved);
      return next;
    });
  };

  const submitGuess = () => {
    const correctOrder = [...puzzle.items];
    const result = items.map((item, i) => {
      const correctIdx = correctOrder.findIndex(c => c.name === item.name);
      return { ...item, diff: Math.abs(i - correctIdx), emoji: getScoreEmoji(Math.abs(i - correctIdx)) };
    });

    const perfect = result.every(r => r.diff === 0);
    setFeedback(result);
    setHistory(prev => [...prev, result.map(r => r.emoji)]);

    if (perfect) {
      setSolved(true);
      setTimeout(() => {
        setAllResults(prev => ({ ...prev, [puzzle.id]: { solved: true, attempts: history.length + 1, grid: [...history, result.map(r => r.emoji)] } }));
        setCompletedRounds(prev => [...prev, puzzle.id]);
        setScreen('result');
      }, 1200);
    } else if (attempt >= maxAttempts) {
      setTimeout(() => {
        setItems(puzzle.items.map((item, i) => ({ ...item, correctIndex: i, id: `item-${i}` })));
        setFeedback(puzzle.items.map((item, i) => ({ ...item, diff: 0, emoji: 'ğŸŸ©' })));
        setTimeout(() => {
          setAllResults(prev => ({ ...prev, [puzzle.id]: { solved: false, attempts: maxAttempts, grid: [...history, result.map(r => r.emoji)] } }));
          setCompletedRounds(prev => [...prev, puzzle.id]);
          setScreen('result');
        }, 1200);
      }, 1500);
    } else {
      setAttempt(prev => prev + 1);
      setTimeout(() => setFeedback(null), 1800);
    }
  };

  // â”€â”€â”€ POINTER DRAG â”€â”€â”€
  const handlePointerDown = (e, index) => {
    if (feedback) return;
    e.preventDefault();
    const el = itemsRef.current[index];
    if (el) dragItemHeight.current = el.getBoundingClientRect().height + 8;
    setActiveItem(index);
    dragStartY.current = e.clientY;
    setDragY(0);
    itemsCopy.current = [...items];
  };

  useEffect(() => {
    if (activeItem === null) return;

    let currentActive = activeItem;
    let currentStartY = dragStartY.current;

    const handleMove = (e) => {
      e.preventDefault();
      const clientY = e.clientY;
      const delta = clientY - currentStartY;
      setDragY(delta);

      const threshold = dragItemHeight.current * 0.5;
      if (delta > threshold && currentActive < items.length - 1) {
        setItems(prev => {
          const next = [...prev];
          const [moved] = next.splice(currentActive, 1);
          next.splice(currentActive + 1, 0, moved);
          return next;
        });
        currentActive = currentActive + 1;
        setActiveItem(currentActive);
        currentStartY = currentStartY + dragItemHeight.current;
        dragStartY.current = currentStartY;
        setDragY(delta - dragItemHeight.current);
      } else if (delta < -threshold && currentActive > 0) {
        setItems(prev => {
          const next = [...prev];
          const [moved] = next.splice(currentActive, 1);
          next.splice(currentActive - 1, 0, moved);
          return next;
        });
        currentActive = currentActive - 1;
        setActiveItem(currentActive);
        currentStartY = currentStartY - dragItemHeight.current;
        dragStartY.current = currentStartY;
        setDragY(delta + dragItemHeight.current);
      }
    };

    const handleEnd = () => {
      setActiveItem(null);
      setDragY(0);
    };

    document.addEventListener('pointermove', handleMove, { passive: false });
    document.addEventListener('pointerup', handleEnd);
    document.addEventListener('pointercancel', handleEnd);

    return () => {
      document.removeEventListener('pointermove', handleMove);
      document.removeEventListener('pointerup', handleEnd);
      document.removeEventListener('pointercancel', handleEnd);
    };
  }, [activeItem, items.length]);

  // â”€â”€â”€ SHARE â”€â”€â”€
  const shareText = () => {
    if (!puzzle) return '';
    const title = `THE LINEUP: ${puzzle.category}`;
    const grid = history.map((row, i) => `${i + 1}. ${row.join('')}`).join('\n');
    const res = solved ? `âœ… Solved in ${history.length}/${maxAttempts}!` : `âŒ ${maxAttempts}/${maxAttempts}`;
    return `${title}\n${puzzle.prompt}\n\n${grid}\n${res}\n\nPlay at buzzfeed.com/the-lineup`;
  };

  const handleShare = async () => {
    try {
      await navigator.clipboard.writeText(shareText());
      setCopied(true);
      setTimeout(() => setCopied(false), 2000);
    } catch (e) { void e; }
  };

  const handleShareAll = async () => {
    const lines = ['THE LINEUP ğŸ¯\n'];
    SAMPLE_PUZZLES.forEach(p => {
      const r = allResults[p.id];
      if (!r) return;
      const lastRow = r.grid[r.grid.length - 1].join('');
      lines.push(`${p.icon} ${p.category}: ${lastRow} ${r.solved ? `âœ… ${r.attempts}/3` : 'âŒ'}`);
    });
    const totalSolved = Object.values(allResults).filter(r => r.solved).length;
    lines.push(`\n${totalSolved}/5 rounds solved`);
    lines.push('\nPlay at buzzfeed.com/the-lineup');
    try {
      await navigator.clipboard.writeText(lines.join('\n'));
      setCopied(true);
      setTimeout(() => setCopied(false), 2000);
    } catch (e) { void e; }
  };

  const font = "'Instrument Sans', 'Helvetica Neue', Helvetica, sans-serif";
  const mono = "'JetBrains Mono', 'SF Mono', 'Fira Code', monospace";

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MENU â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  if (screen === 'menu') {
    const allDone = completedRounds.length === SAMPLE_PUZZLES.length;
    return (
      <div style={{ minHeight: '100vh', background: '#0A0A0A', color: '#FAFAFA', fontFamily: font, display: 'flex', flexDirection: 'column', alignItems: 'center', padding: '0 16px' }}>
        <link href="https://fonts.googleapis.com/css2?family=Instrument+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet" />
        <div style={{ width: '100%', maxWidth: 480, textAlign: 'center', paddingTop: 40, marginBottom: 24 }}>
          <div style={{ fontSize: 13, fontFamily: mono, letterSpacing: '0.2em', color: '#666', textTransform: 'uppercase', marginBottom: 4 }}>BuzzFeed Presents</div>
          <h1 style={{ fontSize: 32, fontWeight: 800, letterSpacing: '-0.02em', margin: 0 }}>THE LINEUP</h1>
          <p style={{ color: '#666', fontSize: 14, marginTop: 4 }}>
            {allDone ? 'All rounds complete! Share your results.' : 'Rank 5 items. 3 attempts. 5 rounds.'}
          </p>
          {completedRounds.length > 0 && !allDone && (
            <div style={{ fontFamily: mono, fontSize: 12, color: '#555', marginTop: 8 }}>Round {completedRounds.length + 1} of 5</div>
          )}
        </div>

        <div style={{ width: '100%', maxWidth: 480, display: 'flex', flexDirection: 'column', gap: 12, marginTop: 16 }}>
          {SAMPLE_PUZZLES.map((p, idx) => {
            const isCompleted = completedRounds.includes(p.id);
            const isNext = idx === currentUnlocked;
            const isLocked = idx > currentUnlocked;
            const result = allResults[p.id];
            return (
              <div
                key={p.id}
                onClick={() => isNext && startGame(p)}
                style={{
                  background: `${p.color}12`,
                  border: `1.5px solid ${isNext ? p.color + '60' : p.color + '20'}`,
                  borderRadius: 16,
                  padding: '20px 24px',
                  display: 'flex',
                  alignItems: 'center',
                  gap: 16,
                  cursor: isNext ? 'pointer' : 'default',
                  transition: 'all 0.2s',
                  opacity: isLocked ? 0.35 : 1,
                }}
              >
                <div style={{ fontSize: 32, width: 56, height: 56, display: 'flex', alignItems: 'center', justifyContent: 'center', borderRadius: 14, background: 'rgba(255,255,255,0.06)' }}>{p.icon}</div>
                <div style={{ flex: 1 }}>
                  <div style={{ fontFamily: mono, fontSize: 11, letterSpacing: '0.15em', textTransform: 'uppercase', color: '#888', marginBottom: 2 }}>{p.category}</div>
                  <div style={{ fontSize: 15, fontWeight: 600, lineHeight: 1.3, color: '#E0E0E0' }}>{p.prompt}</div>
                  {isCompleted && result && (
                    <div style={{ display: 'flex', gap: 3, marginTop: 6, alignItems: 'center' }}>
                      {result.grid[result.grid.length - 1].map((emoji, j) => (
                        <span key={j} style={{ fontSize: 14 }}>{emoji}</span>
                      ))}
                      <span style={{ fontSize: 11, color: '#888', fontFamily: mono, marginLeft: 6 }}>
                        {result.solved ? `${result.attempts}/3` : 'x/3'}
                      </span>
                    </div>
                  )}
                </div>
                <div style={{ marginLeft: 'auto', color: isCompleted ? '#22c55e' : '#555', fontSize: 20, flexShrink: 0 }}>
                  {isCompleted ? 'âœ“' : isNext ? 'â†’' : 'ğŸ”’'}
                </div>
              </div>
            );
          })}
        </div>

        {allDone && (
          <div style={{ maxWidth: 480, width: '100%', textAlign: 'center', marginTop: 24 }}>
            <button onClick={handleShareAll} style={{ background: '#CDFF00', color: '#0A0A0A', border: 'none', borderRadius: 14, padding: '16px 32px', fontSize: 15, fontWeight: 700, fontFamily: font, cursor: 'pointer' }}>
              {copied ? 'âœ“ Copied!' : 'ğŸ“‹ Share All Results'}
            </button>
          </div>
        )}
        <p style={{ color: '#333', fontSize: 12, fontFamily: mono, marginTop: 32, textAlign: 'center' }}>New puzzles every Monday</p>
      </div>
    );
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• RESULT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  if (screen === 'result') {
    return (
      <div style={{ minHeight: '100vh', background: '#0A0A0A', color: '#FAFAFA', fontFamily: font, display: 'flex', flexDirection: 'column', alignItems: 'center', padding: '0 16px' }}>
        <link href="https://fonts.googleapis.com/css2?family=Instrument+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet" />
        <div style={{ width: '100%', maxWidth: 480, textAlign: 'center', paddingTop: 40, marginBottom: 24 }}>
          <div style={{ fontSize: 13, fontFamily: mono, letterSpacing: '0.2em', color: '#666', textTransform: 'uppercase', marginBottom: 4 }}>BuzzFeed Presents</div>
          <h1 style={{ fontSize: 32, fontWeight: 800, letterSpacing: '-0.02em', margin: 0 }}>THE LINEUP</h1>
        </div>
        <div style={{ width: '100%', maxWidth: 480, textAlign: 'center', paddingBottom: 60 }}>
          <div style={{ fontSize: 56, marginBottom: 16 }}>{solved ? 'ğŸ¯' : 'ğŸ˜¤'}</div>
          <div style={{ fontSize: 28, fontWeight: 800, marginBottom: 8 }}>{solved ? `Nailed it in ${history.length}!` : 'Better luck next time'}</div>
          <div style={{ marginBottom: 24 }}>
            <span style={{ display: 'inline-flex', alignItems: 'center', gap: 8, background: `${puzzle.color}20`, border: `1px solid ${puzzle.color}40`, borderRadius: 100, padding: '6px 16px', fontFamily: mono, fontSize: 11, letterSpacing: '0.12em', textTransform: 'uppercase', color: puzzle.color }}>{puzzle.icon} {puzzle.category}</span>
          </div>

          <div style={{ marginBottom: 24 }}>
            {history.map((row, i) => (
              <div key={i} style={{ display: 'flex', justifyContent: 'center', gap: 6, marginBottom: 6 }}>
                {row.map((emoji, j) => <span key={j} style={{ fontSize: 28 }}>{emoji}</span>)}
              </div>
            ))}
          </div>

          <div style={{ textAlign: 'left', marginTop: 32, marginBottom: 24 }}>
            <div style={{ fontFamily: mono, fontSize: 11, letterSpacing: '0.15em', textTransform: 'uppercase', color: '#555', marginBottom: 12 }}>
              Correct order â€” {puzzle.direction}
            </div>
            {puzzle.items.map((item, i) => (
              <div key={i} style={{ display: 'flex', alignItems: 'center', gap: 12, padding: '12px 0', borderBottom: '1px solid rgba(255,255,255,0.06)' }}>
                <div style={{ fontFamily: mono, fontSize: 13, color: '#555', width: 24 }}>#{i + 1}</div>
                <div style={{ flex: 1, fontSize: 14, fontWeight: 600 }}>{item.name}</div>
                <div style={{ fontFamily: mono, fontSize: 13, color: puzzle.color, fontWeight: 600 }}>{item.value}</div>
              </div>
            ))}
          </div>

          <button onClick={handleShare} style={{ background: puzzle.color, color: '#fff', border: 'none', borderRadius: 14, padding: '16px 32px', fontSize: 15, fontWeight: 700, fontFamily: font, cursor: 'pointer', marginTop: 8 }}>
            {copied ? 'âœ“ Copied!' : 'ğŸ“‹ Share Results'}
          </button>
          <br />
          {completedRounds.length < SAMPLE_PUZZLES.length ? (
            <button
              onClick={() => {
                const nextIdx = SAMPLE_PUZZLES.findIndex(p => p.id === puzzle.id) + 1;
                if (nextIdx < SAMPLE_PUZZLES.length) startGame(SAMPLE_PUZZLES[nextIdx]);
                else setScreen('menu');
              }}
              style={{ background: '#FAFAFA', color: '#0A0A0A', border: 'none', borderRadius: 14, padding: '16px 0', width: '100%', fontSize: 15, fontWeight: 700, fontFamily: font, cursor: 'pointer', marginTop: 12, marginBottom: 40 }}
            >
              Next round â†’
            </button>
          ) : (
            <button onClick={() => setScreen('menu')} style={{ background: '#CDFF00', color: '#0A0A0A', border: 'none', borderRadius: 14, padding: '16px 32px', fontSize: 15, fontWeight: 700, fontFamily: font, cursor: 'pointer', marginTop: 12, marginBottom: 40 }}>
              See all results â†’
            </button>
          )}
        </div>
      </div>
    );
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PLAY â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  return (
    <div style={{ minHeight: '100vh', background: '#0A0A0A', color: '#FAFAFA', fontFamily: font, display: 'flex', flexDirection: 'column', alignItems: 'center', padding: '0 16px', touchAction: 'pan-x' }}>
      <link href="https://fonts.googleapis.com/css2?family=Instrument+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet" />
      <div style={{ width: '100%', maxWidth: 480, textAlign: 'center', paddingTop: 40, marginBottom: 24 }}>
        <div style={{ fontSize: 13, fontFamily: mono, letterSpacing: '0.2em', color: '#666', textTransform: 'uppercase', marginBottom: 4 }}>BuzzFeed Presents</div>
        <h1 style={{ fontSize: 32, fontWeight: 800, letterSpacing: '-0.02em', margin: 0 }}>THE LINEUP</h1>
      </div>
      <div style={{ width: '100%', maxWidth: 480 }}>
        <div style={{ display: 'inline-flex', alignItems: 'center', gap: 8, background: `${puzzle.color}20`, border: `1px solid ${puzzle.color}40`, borderRadius: 100, padding: '6px 16px', fontFamily: mono, fontSize: 11, letterSpacing: '0.12em', textTransform: 'uppercase', color: puzzle.color, marginBottom: 8 }}>{puzzle.icon} {puzzle.category}</div>
        <div style={{ fontSize: 20, fontWeight: 700, lineHeight: 1.3, marginBottom: 4 }}>{puzzle.prompt}</div>
        <div style={{ fontSize: 13, color: '#666', fontFamily: mono, marginBottom: 24 }}>Drag to rank: {puzzle.direction}</div>

        <div style={{ display: 'flex', flexDirection: 'column', gap: 8, position: 'relative' }}>
          {items.map((item, index) => {
            const fb = feedback ? feedback[index] : null;
            const isActive = activeItem === index;
            const isGreen = fb && fb.emoji === 'ğŸŸ©';
            const isRed = fb && fb.emoji === 'ğŸŸ¥';

            return (
              <div
                key={item.id}
                ref={el => { itemsRef.current[index] = el; }}
                onPointerDown={(e) => !fb && handlePointerDown(e, index)}
                style={{
                  background: isActive ? 'rgba(255,255,255,0.1)' : isGreen ? '#22c55e18' : isRed ? '#ef444418' : 'rgba(255,255,255,0.04)',
                  border: `1.5px solid ${isActive ? 'rgba(255,255,255,0.3)' : isGreen ? '#22c55e40' : isRed ? '#ef444440' : 'rgba(255,255,255,0.08)'}`,
                  borderRadius: 14,
                  padding: '14px 16px',
                  display: 'flex',
                  alignItems: 'center',
                  gap: 10,
                  transition: isActive ? 'none' : 'all 0.25s cubic-bezier(0.2, 0, 0, 1)',
                  transform: isActive ? `translateY(${dragY}px) scale(1.03)` : 'translateY(0) scale(1)',
                  boxShadow: isActive ? '0 8px 32px rgba(0,0,0,0.4)' : 'none',
                  zIndex: isActive ? 10 : 1,
                  position: 'relative',
                  userSelect: 'none',
                  touchAction: 'none',
                  cursor: fb ? 'default' : 'grab',
                }}
              >
                {/* Drag handle icon (visual cue) */}
                {!fb && (
                  <div style={{ color: isActive ? '#aaa' : '#555', fontSize: 22, flexShrink: 0, lineHeight: 1 }}>â ¿</div>
                )}
                {fb && <div style={{ fontSize: 20, flexShrink: 0 }}>{fb.emoji}</div>}

                <div style={{ fontFamily: mono, fontSize: 13, color: '#555', width: 22, flexShrink: 0 }}>{index + 1}.</div>
                <div style={{ flex: 1, fontSize: 15, fontWeight: 600, lineHeight: 1.3 }}>{item.name}</div>

                {fb && fb.diff === 0 && (
                  <div style={{ fontFamily: mono, fontSize: 12, color: puzzle.color, flexShrink: 0 }}>{item.value}</div>
                )}
              </div>
            );
          })}
        </div>

        {/* Attempt bar */}
        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginTop: 20, marginBottom: 12 }}>
          <div style={{ fontFamily: mono, fontSize: 12, color: '#555' }}>Attempt {attempt}/{maxAttempts}</div>
          <div style={{ display: 'flex', gap: 8 }}>
            {Array.from({ length: maxAttempts }).map((_, i) => (
              <div key={i} style={{ width: 10, height: 10, borderRadius: '50%', background: i < attempt ? '#fff' : 'rgba(255,255,255,0.15)', transition: 'background 0.2s' }} />
            ))}
          </div>
        </div>

        {!feedback && (
          <button onClick={submitGuess} style={{ background: '#FAFAFA', color: '#0A0A0A', border: 'none', borderRadius: 14, padding: '16px 0', width: '100%', fontSize: 15, fontWeight: 700, fontFamily: font, cursor: 'pointer', letterSpacing: '0.02em' }}>
            Lock in my order â†’
          </button>
        )}
        {feedback && !solved && attempt <= maxAttempts && (
          <div style={{ textAlign: 'center', color: '#666', fontSize: 14, fontFamily: mono, padding: '12px 0' }}>
            {attempt > maxAttempts ? 'Revealing correct order...' : 'Rearrange and try again...'}
          </div>
        )}
        <div style={{ height: 40 }} />
      </div>
    </div>
  );
}
